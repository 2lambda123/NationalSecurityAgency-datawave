This poller is an implementation of JPoller 1.5.1. The nsa.datawave.poller.Poller class is a java application that configures the JPoller DirectoryPoller and PollManager objects.

Currently, the poller accepts the following options:

usage: Poller  [-c <arg>] -d <arg> -e <arg> [-f <arg>] -h <arg> -i <arg> -l <arg> -m <arg> -q <arg> -r <arg> -t <arg> [-v] -w <arg> [-z]

 -c,--comparator <arg>      Comparator class to use for ordering the
                            processing of files
 -d,--directories <arg>     comma separated list of directories to poll
 -e,--errorDir <arg>        Local error directory *****
 -f,--filter <arg>          FilenameFilter implementation class name
 -h,--hdfsDestDir <arg>     Base destination directory in HDFS *****
 -i,--interval <arg>        number of ms between each poll
 -l,--latency <arg>         ms to wait before closing the output file *****
 -m,--manager <arg>         poll manager implementation class name
 -q,--queue <arg>           comma separated list of directories to place
                            the in-process files
 -r,--completedDir <arg>    directory for completed files that have not
                            been copied into HDFS. *****
 -t,--datatype <arg>        Datatype *****
 -v,--verbose               be verbose
 -w,--workDir <arg>         local work directory *****
 -z,--compressedInputFile   if supplied, input files are compressed and
                            will be read using GZIP *****
-rr,--recordReader          fully qualified class name of the record reader 
							to use for the input file #####
-kc,--keyClass				fully qualified class name of the key that the
							record reader emits #####
-vc,--valueClass			fully qualified class name of the value that the
							record reader emits #####
-cf,--confFiles				comma separated list of HDFS configuration files 
							that are used by the record reader (i.e. *-config.xml, etc) #####

The nsa.datawave.poller.manager.FileCombiningPollManager is an implementation of a PollManager that can be used to combine input files on local disk and move them into HDFS.
The options above that are marked with ***** are options for the FileCombiningPollManager. Below is a description of the data flow using the FileCombiningPollManager:

0. Upon startup, the FileCombiningPollManager will copy any files located in the completed directory (-r) into HDFS using the logic in steps 5 & 6.
1. Files that pass the filter (-f) in the directories (-d) are moved into the queue directories (-q), this process is repeated at the specified poll interval (-i).
2. The files are then processed by the poll manager, in the order specified by the comparator (-c), if one is specified.
3. The FileCombiningPollManager creates a new gzip output file in the work directory (-w) if a new output file is needed.
4. The FileCombiningPollManager copies the contents of the file from the input directory the output gzip file. This process is repeated for each input file
   until a threshold is reached (either output file size or time latency (-l) )
5. When a new output file is needed, the current output gzip file is closed and copied to a 'temp' directory, which will be a subdirectory of the HDFS
   destination directory (-h).
6. After being copied to the temp directory, it is then moved to its final destination directory, which located at the path of hdfs destination directory / datatype (-t) /
   / year / month / day.
7. If successful, all of the input files that contributed to the output gzip file are deleted from the queue directory.
8. If not successful in copying the file to HDFS, then the output gzip file is moved into the completed directory (-r)
9. If not successful elsewhere, the input files and/or the gzip output file may be moved to the error (-e) directory. 


The nsa.datawave.poller.manager.SequenceFileCombiningPollManager is an extension of the FileCombiningPollManager. However, instead of performing a byte for byte
copy of the input file, it translates the input data into key-value pairs using HDFS record readers. The output file is a HDFS block compressed sequence file.
The options above that are marked with ##### are options for the TranslatingFileCombiningPollManager and are used in conjunction with the other properties.

--> Stopping the poller

The poller application registers a shutdown hook with the JVM. When shutdown gracefully (i.e. kill -HUP %pid), then the poller will finish processing the file that it
is working on, and tries to copy into HDFS. If copying into HDFS throws an exception, then the file will put moved into the completedDir. If the poller is not shutdown
gracefully (i.e. kill -9 %pid), then you will have to manually clean up the work area before restarting. The simplest thing to do is remove files from the work and hdfs
temp directories and then copy files from the queue directory back to polled directory.
